<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Analyzer Dashboard (Live)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://visjs.github.io/vis-network/standalone/umd/vis-network.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="p-4 sm:p-8 text-gray-300">

    <div class="max-w-7xl mx-auto bg-[#161b22] rounded-xl shadow-2xl shadow-indigo-900/50">
        <header class="p-4 border-b border-[#30363d] flex items-center justify-between"><h1 class="text-2xl font-bold text-white flex items-center"><svg class="w-6 h-6 mr-2 text-indigo-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a8 8 0 00-8 8c0 1.95.84 3.75 2.19 5.06l-.01.01L10 18.84l5.82-1.77a8 8 0 002.19-5.06 8 8 0 00-8-8zM10 16a6 6 0 110-12 6 6 0 010 12zM9 9h2v4H9V9z"></path></svg>Packet Surveillance Unit: Live Packet Analyzer</h1><span id="connection-status" class="text-sm font-medium text-red-400"><span id="status-dot" class="status-dot"></span>Disconnected</span></header>
        <nav class="flex border-b border-[#30363d] text-sm font-medium overflow-x-auto">
            <button class="nav-button p-3 border-r border-[#30363d] text-indigo-400 bg-[#21262d] transition whitespace-nowrap" data-page="dashboard">Dashboard</button>
            <button class="nav-button p-3 border-r border-[#30363d] text-gray-400 hover:text-indigo-400 hover:bg-[#21262d] transition whitespace-nowrap" data-page="live-capture">Live Capture</button>
            <button class="nav-button p-3 border-r border-[#30363d] text-gray-400 hover:text-indigo-400 hover:bg-[#21262d] transition whitespace-nowrap" data-page="wireless-env">Wireless Env</button>
            <button class="nav-button p-3 border-r border-[#30363d] text-gray-400 hover:text-indigo-400 hover:bg-[#21262d] transition whitespace-nowrap" data-page="analysis-stats">Analysis</button>
            <button class="nav-button p-3 border-r border-[#30363d] text-gray-400 hover:text-indigo-400 hover:bg-[#21262d] transition whitespace-nowrap" data-page="network-graph">Network Graph</button>
            <button class="nav-button p-3 border-r border-[#30363d] text-gray-400 hover:text-indigo-400 hover:bg-[#21262d] transition whitespace-nowrap" data-page="global-stats">Global Stats</button>
            <button class="nav-button p-3 border-r border-[#30363d] text-gray-400 hover:text-indigo-400 hover:bg-[#21262d] transition whitespace-nowrap" data-page="alerts">Alerts</button>
            <button class="nav-button p-3 text-gray-400 hover:text-indigo-400 hover:bg-[#21262d] transition whitespace-nowrap" data-page="history">History</button>
        </nav>
        <div class="p-4 bg-[#21262d] rounded-b-xl flex flex-wrap items-end gap-4 mb-4">
            <div class="flex-auto flex gap-4"><div class="flex-1 min-w-[120px]"><label for="interface-select" class="block text-xs font-medium text-gray-400 mb-1">Interface:</label><select id="interface-select" class="w-full bg-gray-700 border border-gray-600 text-white text-sm rounded-lg p-2"><option>Loading...</option></select></div><div class="flex-1 min-w-[120px]"><label for="filter-input" class="block text-xs font-medium text-gray-400 mb-1">Capture Filter:</label><input type="text" id="filter-input" placeholder="e.g., tcp port 80" class="w-full bg-gray-700 border border-gray-600 text-white text-sm rounded-lg p-2"></div></div>
            <div class="flex-none flex space-x-2 w-full sm:w-auto">
                <button id="start-button" onclick="startCapture()" class="flex-1 px-4 py-2 text-sm font-semibold text-white bg-green-600 rounded-lg hover:bg-green-700">Start</button>
                <button id="stop-button" onclick="stopCapture()" class="flex-1 px-4 py-2 text-sm font-semibold text-white bg-red-600 rounded-lg hover:bg-red-700">Stop</button>
                <button id="end-session-button" onclick="endSession()" class="flex-1 px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700">End Session</button>
                <button onclick="if(confirm('Are you sure you want to clear all displayed data?')) clearAllData()" class="px-3 py-2 text-sm font-semibold text-white bg-gray-600 rounded-lg hover:bg-gray-700">Clear Display</button>
            </div>
        </div>

        <main class="p-6">
            <div id="dashboard-page" class="page-content"><h2 class="text-xl font-semibold text-white mb-4">Live Dashboard</h2><div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d] text-center"><div class="text-sm text-gray-400">Total Packets</div><div id="summary-packets" class="text-3xl font-bold text-indigo-400">0</div></div><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d] text-center"><div class="text-sm text-gray-400">Data Captured</div><div id="summary-data" class="text-3xl font-bold text-indigo-400">0 MB</div></div><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d] text-center"><div class="text-sm text-gray-400">Unique Devices</div><div id="summary-devices" class="text-3xl font-bold text-indigo-400">0</div></div><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d] text-center"><div class="text-sm text-gray-400">Security Alerts</div><div id="summary-alerts" class="text-3xl font-bold text-red-400">0</div></div></div><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d] mb-8"><h3 class="text-lg font-semibold text-white mb-3 text-center">Interface Throughput (Mbps)</h3><div class="h-64"><canvas id="timeline-chart"></canvas></div></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8"><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d]"><h3 class="text-lg font-semibold text-white mb-3 text-center">Protocol Distribution</h3><div class="h-80 flex justify-center items-center"><canvas id="protocol-chart"></canvas></div></div><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d]"><h3 class="text-lg font-semibold text-white mb-3 text-center">802.11 Frame Types</h3><div class="h-80 flex justify-center items-center"><canvas id="wifi-chart"></canvas></div></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-8"><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d]"><h3 class="text-lg font-semibold text-white mb-3 text-center">Server CPU Usage</h3><div class="relative h-32 w-32 mx-auto"><svg class="w-full h-full" viewBox="0 0 36 36"><path class="text-gray-700" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke-width="3.8"></path><path id="cpu-gauge-bar" class="text-indigo-400" stroke-width="3.8" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke-linecap="round"></path></svg><div id="cpu-gauge-text" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-xl font-bold">0%</div></div></div><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d]"><h3 class="text-lg font-semibold text-white mb-3 text-center">Server Memory Usage</h3><div class="relative h-32 w-32 mx-auto"><svg class="w-full h-full" viewBox="0 0 36 36"><path class="text-gray-700" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke-width="3.8"></path><path id="mem-gauge-bar" class="text-green-400" stroke-width="3.8" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke-linecap="round"></path></svg><div id="mem-gauge-text" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-xl font-bold">0%</div></div></div></div></div>
            <div id="live-capture-page" class="page-content hidden"><h2 class="text-xl font-semibold text-white mb-4">Raw Packet Log</h2><div class="flex items-center justify-between space-x-3 mb-4"><div class="flex-grow"><label for="display-filter-input" class="block text-xs font-medium text-gray-400 mb-1">Display Filter:</label><input type="text" id="display-filter-input" placeholder="e.g., proto:tcp src:192.168.1.1" class="w-full bg-gray-700 border border-gray-600 text-white text-sm rounded-lg p-2" onkeyup="applyDisplayFilter()"></div><div class="flex items-center space-x-2 pt-5"><input id="auto-scroll-checkbox" type="checkbox" checked class="h-4 w-4 rounded bg-gray-700 border-gray-600 text-indigo-600 focus:ring-indigo-500"><label for="auto-scroll-checkbox" class="text-sm text-gray-400">Auto-Scroll</label></div></div><div class="text-sm text-gray-400 mb-2">Total Packets Seen: <span id="packet-count" class="text-indigo-400 font-bold">0</span></div><div class="overflow-y-auto h-[70vh] bg-[#0d1117] p-2 rounded-lg border border-[#30363d]"><table class="log-table min-w-full text-white"><thead><tr><th>#</th><th>Time</th><th>Protocol</th><th>Source</th><th>Destination</th><th>Length</th><th>Info</th></tr></thead><tbody id="packet-table-body"></tbody></table></div></div>
            <div id="wireless-env-page" class="page-content hidden"><h2 class="text-xl font-semibold text-white mb-4">Live Wireless Environment</h2><div class="scrollable-table-container mb-8"><h3 class="text-lg font-semibold text-white mt-4 mb-3 px-2">Discovered Networks (from Beacons)</h3><table class="discovery-table min-w-full text-white"><thead><tr><th>SSID</th><th>BSSID (MAC)</th><th>Channel</th><th>Last Seen</th></tr></thead><tbody id="env-networks-body"></tbody></table></div><div class="scrollable-table-container"><h3 class="text-lg font-semibold text-white mt-8 mb-3 px-2">Discovered Devices (from Probes)</h3><table class="discovery-table min-w-full text-white"><thead><tr><th>Device MAC</th><th>Probing For SSIDs</th><th>Last Seen</th></tr></thead><tbody id="env-devices-body"></tbody></table></div></div>
            <div id="history-page" class="page-content hidden"><h2 class="text-xl font-semibold text-white mb-4">Capture History</h2><div class="overflow-x-auto h-[70vh] bg-[#21262d] p-2 rounded-lg border border-[#30363d]"><table class="history-table min-w-full text-white"><thead><tr><th>Session ID</th><th>Start Time</th><th>Duration</th><th>Status</th><th class="text-right">Actions</th></tr></thead><tbody id="history-table-body"></tbody></table></div></div>
            <div id="analysis-stats-page" class="page-content hidden"><h2 class="text-xl font-semibold text-white mb-4">Session Analysis</h2><div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8"><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d]"><h3 class="text-lg font-semibold text-white mb-3 text-center">Top Talkers (by Packets)</h3><div class="h-96"><canvas id="endpoint-chart"></canvas></div></div><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d]"><h3 class="text-lg font-semibold text-white mb-3 text-center">Top Talkers (by Data Volume)</h3><div class="h-96"><canvas id="data-volume-chart"></canvas></div></div></div><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d] mb-8"><h3 class="text-lg font-semibold text-white mb-3 text-center">Top Services (by Port)</h3><div class="h-96"><canvas id="service-chart"></canvas></div></div><h3 class="text-lg font-semibold text-white mt-8 mb-3">Security Events Log</h3><div class="overflow-x-auto bg-[#21262d] p-2 rounded-lg border border-[#30363d]"><table class="discovery-table min-w-full text-white"><thead><tr><th>Time</th><th>Event Type</th><th>Details</th></tr></thead><tbody id="security-events-body"></tbody></table></div></div>
            <div id="network-graph-page" class="page-content hidden"><h2 class="text-xl font-semibold text-white mb-4">Live Network Graph</h2><div id="network-graph-container" class="bg-[#0d1117] border border-[#30363d] rounded-lg h-[75vh]"></div></div>
            
            <div id="global-stats-page" class="page-content hidden"><h2 class="text-xl font-semibold text-white mb-4">Global Analysis Dashboard</h2><div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8"><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d] text-center"><div class="text-sm text-gray-400">Total Packets</div><div id="global-packets" class="text-3xl font-bold text-indigo-400">0</div></div><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d] text-center"><div class="text-sm text-gray-400">Total Data</div><div id="global-data" class="text-3xl font-bold text-indigo-400">0 GB</div></div><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d] text-center"><div class="text-sm text-gray-400">Total Sessions</div><div id="global-sessions" class="text-3xl font-bold text-indigo-400">0</div></div></div><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d] mb-8"><h3 class="text-lg font-semibold text-white mb-3 text-center">Packets Captured Per Day</h3><div class="h-80"><canvas id="activity-trend-chart"></canvas></div></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d]"><h3 class="text-lg font-semibold text-white mb-3 text-center">All-Time Protocol Distribution</h3><div class="h-96"><canvas id="global-protocol-chart"></canvas></div></div><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d]"><h3 class="text-lg font-semibold text-white mb-3 text-center">Busiest Devices (All Time)</h3><div class="h-96"><canvas id="global-top-talkers-chart"></canvas></div></div></div></div>
            <div id="alerts-page" class="page-content hidden"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-semibold text-white">Alert Configuration & Log</h2><button id="save-alerts-button" class="px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700">Save Settings</button></div><div class="bg-[#21262d] p-4 rounded-lg border border-[#30363d] mb-8 space-y-4"><div class="flex items-center justify-between"><label for="alert-cpu-threshold" class="text-gray-300">CPU Usage Threshold (%)</label><input type="number" id="alert-cpu-threshold" value="90" class="w-24 bg-gray-700 border border-gray-600 text-white text-sm rounded-lg p-2"></div><div class="flex items-center justify-between"><label for="alert-throughput-threshold" class="text-gray-300">Throughput Threshold (Mbps)</label><input type="number" id="alert-throughput-threshold" value="100" class="w-24 bg-gray-700 border border-gray-600 text-white text-sm rounded-lg p-2"></div><div class="flex items-center"><input id="alert-deauth-checkbox" type="checkbox" checked class="h-4 w-4 rounded bg-gray-700 border-gray-600 text-indigo-600 focus:ring-indigo-500"><label for="alert-deauth-checkbox" class="ml-2 text-gray-300">Alert on Deauthentication/Disassociation Attacks</label></div><div class="flex items-center"><input id="alert-arp-checkbox" type="checkbox" checked class="h-4 w-4 rounded bg-gray-700 border-gray-600 text-indigo-600 focus:ring-indigo-500"><label for="alert-arp-checkbox" class="ml-2 text-gray-300">Alert on Potential ARP Spoofing</label></div></div><h3 class="text-lg font-semibold text-white mt-8 mb-3">Triggered Alerts Log</h3><div class="scrollable-table-container"><table class="discovery-table min-w-full text-white"><thead><tr><th>Time</th><th>Alert Type</th><th>Details</th></tr></thead><tbody id="alerts-log-body"></tbody></table></div></div>
        </main>
    </div>
    <div id="packet-detail-modal" class="modal-overlay hidden" onclick="closePacketDetails()"><div class="modal-content" onclick="event.stopPropagation()"><div class="modal-header"><h2 id="modal-title">Packet Details</h2><button class="modal-close-button" onclick="closePacketDetails()">&times;</button></div><div id="modal-body" class="packet-detail-tree"></div></div></div>
    <script src="script.js"></script>
</body>
</html>